// PNNL App Sidebar
// Author: Geoff Elliott

@media (min-width: @screen-sm-min) {
    .has-sidebar,
    .PnnlSidebarWrapper {
        display: flex;
        overflow: hidden;

        > * {
            flex-grow: 1; 
        }

        .PnnlSidebarNeighbor,
        &.left .PnnlSidebarNeighbor {
            margin-left: @padding-base-horizontal;
        }

        &.right .PnnlSidebarNeighbor {
            margin-right: @padding-base-horizontal;
        }

        &.left .PnnlSidebarToggle {
            border-right: 1px solid @platinum-50;
        }

        &.right .PnnlSidebarToggle {
            border-left: 1px solid @platinum-50;
        }

        .PnnlSidebarToggle {
            position: relative;
            flex-grow: 0;
            border-radius: 0;
            width: @padding-base-horizontal;
            border: none;
            background-color: @platinum-30;
            color: @platinum-80;
            padding: 0;
            overflow: hidden;
            box-shadow: none;

            &:hover {
                background-color: @platinum-50;
                color: @platinum;
            }

            div {
                position: absolute;
                left: 0;
                white-space: nowrap;
                transform-origin: top left;
                transform: rotate(-90deg);
                text-transform: uppercase;
                height: @padding-base-horizontal;
            }

            .PnnlIcon {
                width: @padding-base-horizontal;
                height: @padding-base-horizontal;
                top: -1px;
                bottom: 0;
            }

            small {
                display: inline-block;
                position: relative;
                top: -4px; /* Not left, because we rotate the element */
                padding: 0 @padding-base-horizontal;
                line-height: @padding-base-horizontal;
            }
        }
    }
}

.calc-sidebar-exit-margin(@index, @class, @type) when (@index <= @grid-columns) {
    &.col-@{class}-@{index} {
        margin-@{type}: -(percentage((@index / @grid-columns)));
    }
}

// Basic looping in LESS
.loop-sidebar-margins(@index, @class, @type) when (@index >= 0) {
    .calc-sidebar-exit-margin(@index, @class, @type);
    // next iteration
    .loop-sidebar-margins((@index - 1), @class, @type);
}

.pnnl-sidebar,
.PnnlSidebar {
    background-color: @platinum-20;
    margin-bottom: 0;
    margin-left: 0;
    flex-grow: 0;

    .PnnlSidebarWrapper:not(.right) &,
    .PnnlSidebarWrapper.left & {
        border-right: 1px solid @platinum-50;
        transition: margin-left 400ms ease;

        &.PnnlSidebar-exit, &.PnnlSidebar-exit-done {
            @media (max-width: @screen-xs-max) {
                .loop-sidebar-margins(@grid-columns, ~"xs", ~"left");
            }
            
            @media (min-width: @screen-sm-min) {
                .loop-sidebar-margins(@grid-columns, ~"sm", ~"left");
            }
            
            @media (min-width: @screen-md-min) {
                .loop-sidebar-margins(@grid-columns, ~"md", ~"left");
            }
            
            @media (min-width: @screen-lg-min) {
                .loop-sidebar-margins(@grid-columns, ~"lg", ~"left");
            }
            
            @media (min-width: @screen-xl-min) {
                .loop-sidebar-margins(@grid-columns, ~"xl", ~"left");
            }
        }
    }

    .PnnlSidebarWrapper.right & {
        border-left: 1px solid @platinum-50;
        transition: margin-right 400ms ease;
        
        &.PnnlSidebar-exit, &.PnnlSidebar-exit-done {
            @media (max-width: @screen-xs-max) {
                .loop-sidebar-margins(@grid-columns, ~"xs", ~"right");
            }
            
            @media (min-width: @screen-sm-min) {
                .loop-sidebar-margins(@grid-columns, ~"sm", ~"right");
            }
            
            @media (min-width: @screen-md-min) {
                .loop-sidebar-margins(@grid-columns, ~"md", ~"right");
            }
            
            @media (min-width: @screen-lg-min) {
                .loop-sidebar-margins(@grid-columns, ~"lg", ~"right");
            }
            
            @media (min-width: @screen-xl-min) {
                .loop-sidebar-margins(@grid-columns, ~"xl", ~"right");
            }
        }
    }


    .fixed {
        @media (min-width: @screen-sm-min) {
            width: 104px;
            position: fixed;
        }

        @media (min-width: @screen-md-min) {
            width: 130px;
        }

        @media (min-width: @screen-lg-min) {
            width: 266px;
        }
    }

    .PnnlAction {
        line-height: 1;

        .PnnlIcon {
            font-size: @font-size-base;
        }
    }

    .panel, 
    .panel-heading, 
    .panel-body, 
    .PnnlSidebarItem {
        margin: 0 -@padding-base-horizontal;
    }

    .panel, 
    .panel-body {
        padding: 0 @padding-base-horizontal;
    }

    .panel-heading, 
    .panel-title, 
    .PnnlSidebarItem {
        padding: @padding-base-vertical @padding-base-horizontal;
    }

    .panel {
        border: none;
        border-bottom: 1px solid @platinum-50;
        border-radius: 0;
        background-color: transparent;

        & + .panel {
            margin-top: 0;
        }
    }

    .panel-heading, 
    .PnnlSidebarItem {
        margin: 0 -@padding-base-horizontal;
        border-radius: 0;

        > a,
        button,
        .btn-group {
            flex-grow: 1;
            padding: @padding-base-vertical @padding-base-horizontal;
            margin: -@padding-base-vertical 0;
            background-color: transparent;
            border: 0;
            box-shadow: none;
            border-radius: 0;
        }

        .btn-group {
            display: flex;

            > .btn,
            > .btn:first-child {
                float: none;
                margin: -@padding-base-vertical -@padding-base-horizontal;
            }
        }

        > :first-child {
            margin-left: -@padding-base-horizontal;
        }

        > :last-child {
            margin-right: -@padding-base-horizontal;
        }

        button.btn:not(.dropdown-toggle),
        button.btn:not(.PnnlAction) {
            text-align: left;
        }

        &:not(.active) {
            > a, 
            button {
                &:hover {
                    background-color: rgba(0,0,0,0.07);
                }
            }
        }

        &:not(.active),
        &.active {
            .PnnlAction:hover {
                background-color: rgba(0,0,0,0.07);
                color: @text-color;
            }
        }

        .dropdown.open {
            .PnnlAction {
                background-color: rgba(0,0,0,0.07);
            }
        }

        [class*=PnnlValidationIcon] {
            display: inline-block;
            margin-right: @padding-small-horizontal;
        }
    }

    .panel-heading {
        border-radius: 0;
        border-bottom: none;
        background-color: @platinum-40;
        color: @onyx-70;
        position: relative;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-between;
        align-items: stretch;
        align-content: stretch;

        button.btn, 
        .btn-group {
            flex-grow: 0;
        }

        .arrow {
            display: inline-block;
            margin-left: @padding-small-horizontal;
        }
    }

    .panel-title {
        font-size: @font-size-base;
        flex-grow: 1;
        margin: -@padding-base-vertical 0;

        > a {
            transition: all 0.2s ease;
            text-decoration: none;
            // flex-grow: 1;
            display: block;
            padding: @padding-base-vertical @padding-base-horizontal;
            margin: -@padding-base-vertical -@padding-base-horizontal;
            color: @onyx-70;

            &:link, 
            &:visited {
                color: @onyx-70;
            }

            &:hover {
                background-color: rgba(0,0,0,0.07);
            }
        }
    }

    .PnnlSidebarItem {
        background-color: transparent;
        border: none;
        border-radius: 0;
        margin-bottom: 0;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-between;
        align-items: stretch;
        align-content: stretch;

        & + .PnnlSidebarItem {
            border-top: 1px solid @platinum-50;
        }

        > a,
        > button {
            transition: all 0.2s ease;
        }

        a:link, 
        a:visited {
            &:not([role=menuitem]) {
                color: @link-color;
            }
        }

        .badge {
            color: @text-color;
            background-color: rgba(0,0,0,0.07);
            float: right;
            display: block;
            margin-top: 3px;
            margin-left: @padding-small-horizontal;
        }

        &.active {
            background-color: @platinum-10;
            background-image: linear-gradient(to right, @bronze, @bronze 5px, transparent 5px, transparent);
            color: @bronze;
            cursor: default;

            > a, 
            > button:not(.PnnlAction) {
                text-decoration: none;
                color: @bronze;
            }
        }

        .PnnlAction,
        .btn-group {
            flex-grow: 0;
        }
    }
}
